# SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0

# Allow the Bazel server to check directory sources for changes. Ensures that the Bazel server
# notices when a directory changes, if you have a directory listed in the srcs of some target.
# Recommended when using
# [copy_directory](https://github.com/aspect-build/bazel-lib/blob/main/docs/copy_directory.md) and
# [rules_js](https://github.com/aspect-build/rules_js) since npm package are source directories
# inputs to copy_directory actions.
# Docs: https://bazel.build/reference/command-line-reference#flag--host_jvm_args
startup --host_jvm_args=-DBAZEL_TRACK_SOURCE_DIRECTORIES=1

# Performance optimizations
build --show_timestamps
build --reuse_sandbox_directories
build --nolegacy_external_runfiles
build --http_max_parallel_downloads=16
build --remote_download_outputs=minimal
build --noexperimental_check_external_repository_files
fetch --noexperimental_check_external_repository_files
query --noexperimental_check_external_repository_files

# Correctness settings
build --sandbox_default_allow_network=false
build --incompatible_default_to_explicit_init_py

# Config to stamp the version info on the Python Library wheel when creating distribution
build:stamp_py_wheel --stamp
build:stamp_py_wheel --workspace_status_command=src/lib/distribution/stamp.sh

# Print test errors
test --test_output=errors

# MyPy Type Checking
test --aspects @osmo_workspace//bzl/mypy:mypy.bzl%mypy_aspect --test_keep_going
test --output_groups=+mypy
